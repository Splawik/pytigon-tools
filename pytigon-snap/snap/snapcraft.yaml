name: pytigon
version: "0.7"
summary: "Pytigon summary"
description: |
  Pytigon description

grade: stable
confinement: strict
base: core20

plugs:
  dot-config-pytigon:
    interface: personal-files
    write:
      - $HOME/.pytigon

apps:
  pytigon:
    command: bin/python3.9 -m pytigon.ptig
    extensions: [gnome-3-38]
    plugs:
      - unity7
      - audio-playback
      - home
      - network
      - dot-config-pytigon

  python:
    command: bin/python3.9
    plugs:
      - unity7
      - audio-playback
      - home
      - network
      - dot-config-pytigon

parts:
  pytigon:
    plugin: python
    source: .

    build-environment:
      - SNAPCRAFT_PYTHON_INTERPRETER: python3.9
      - PATH: $SNAPCRAFT_PART_INSTALL/bin:$PATH
      - PYTHONPATH: ""

    build-packages:
      - python3.9-venv
      - python3.9-dev
      - python3.9-distutils

    override-build: |
      # Work around a bug in snapcraft python plugin
      # https://forum.snapcraft.io/t/build-a-snap-with-any-version-of-python-i-want/10420/8
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/lib/python3.9/distutils
      cp -r /usr/lib/python3.9/distutils $SNAPCRAFT_PART_INSTALL/usr/lib/python3.9/distutils
      mkdir -p $SNAPCRAFT_PART_INSTALL/usr/include/
      cp -r /usr/include/python3.9 $SNAPCRAFT_PART_INSTALL/usr/include/python3.9
      snapcraftctl build

    stage-packages:
      - freeglut3
      - freeglut3-dev
      - libgl1-mesa-dev
      - libglu1-mesa-dev
      - libgstreamer-plugins-base1.0-dev
      - libgtk-3-dev
      - libjpeg-dev
      - libnotify-dev
      - libsdl2-dev
      - libsm-dev
      - libtiff-dev
      - libwebkit2gtk-4.0-dev
      - libxtst-dev

      - libssl-dev
      #- libsdl1.2-dev
      #- ibus-gtk3
      #- libwebkit2gtk-4.0-dev
      #- libwebkit2gtk-4.0-37
      #- libwebkit2gtk-4.1-dev
      - zlib1g
      #- libsm6
      #- libslang2
      #- libsdl1.2debian
      #- libgtk2.0-0
      #- libpcre3
      #- liblzma5
      - libpython3.9-dev
      - libpython3.9-stdlib

      #- libpython3.8-stdlib
      #- libpython3.8-minimal
      #- python3-pip
      #- python3-setuptools
      #- python3-wheel
      #- python3-venv
      #- python3-minimal
      #- python3-distutils
      #- python3-pkg-resources
      - python3.9-venv
      - python3.9

    python-packages:
      #- setuptools
      #- pip>9
      - django<4
      - h11<0.13
      - cryptography==38.0.1
      - pyopenssl
      - pyjwt<3
      - pytigon-lib
      - pytigon
      - pytigon-batteries
      #- https://extras.wxpython.org/wxPython4/extras/linux/gtk3/ubuntu-18.04/wxPython-4.1.1-cp36-cp36m-linux_x86_64.whl
      - https://extras.wxpython.org/wxPython4/extras/linux/gtk3/ubuntu-20.04/wxPython-4.2.0-cp39-cp39-linux_x86_64.whl
      #- https://extras.wxpython.org/wxPython4/extras/linux/gtk3/ubuntu-22.04/wxPython-4.2.0-cp310-cp310-linux_x86_64.whl
      - pytigon-gui
